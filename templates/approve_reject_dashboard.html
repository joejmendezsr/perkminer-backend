<!DOCTYPE html>
<html>
<head>
    <title>Approve/Reject Listings - Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
      th, td { word-break: break-word; }
      @media (max-width: 768px) {
        .btn, .btn-sm, .btn-primary, .btn-success, .btn-danger, .btn-secondary { font-size: 1em !important; }
        .card, .border, .bg-white { box-sizing: border-box; width: 100%; }
        .rounded-circle { width: 44px !important; height: 44px !important; }
      }
    </style>
</head>
<body>
<div class="container py-3" style="max-width:920px;">
    <h2 class="mb-4 text-center">Approve/Reject Listings</h2>
    <div class="alert alert-info text-center">
        Here you will manage and review submissions.
    </div>
    {% if pending_listings %}
      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Business Name</th>
              <th>Category</th>
              <th>Email</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for biz in pending_listings %}
              <tr {% if biz.status == "in_review" %}class="table-warning"{% endif %}>
                <td>{{ biz.id }}</td>
                <td>{{ biz.business_name }}</td>
                <td>{{ biz.category }}</td>
                <td>{{ biz.business_email }}</td>
                <td>
                  {% if biz.status == "pending" %}
                    <span class="badge rounded-pill bg-secondary">Pending Review</span>
                  {% elif biz.status == "in_review" %}
                    <span class="badge rounded-pill bg-warning text-dark">In Review</span>
                  {% endif %}
                </td>
                <td class="d-flex flex-wrap gap-1 align-items-center" style="min-width:145px;">
                  <form method="post" action="{{ url_for('start_review', listing_id=biz.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-primary btn-sm"
                      {% if biz.status != "pending" %}disabled{% endif %}>
                      Start Review
                    </button>
                  </form>
                  <form method="post" action="{{ url_for('approve_listing', listing_id=biz.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-success btn-sm"
                      {% if biz.status != "in_review" %}disabled{% endif %}>
                      Approve
                    </button>
                  </form>
                  <form method="post" action="{{ url_for('reject_listing', listing_id=biz.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-danger btn-sm"
                      {% if biz.status != "in_review" %}disabled{% endif %}>
                      Reject
                    </button>
                  </form>
                </td>
              </tr>
              <tr>
                <td colspan="6" class="bg-light">
                  <!-- Small Listing Preview -->
                  <div class="mb-3 p-2 border rounded bg-white">
                    <strong>Small Preview</strong>
                    <div class="d-flex align-items-center mt-1 mb-2 flex-wrap gap-2">
                      {% if biz.profile_photo %}
                        <img src="{{ biz.profile_photo }}" class="rounded-circle me-2" style="width:60px; height:60px; object-fit:cover;">
                      {% endif %}
                      <div>
                        <b>{{ biz.business_name }}</b><br/>
                        <span class="text-muted">{{ biz.category }}</span><br/>
                        <span>{{ biz.address }}</span><br/>
                        <small>
                          Services:
                          {%- set services = [biz.service_1, biz.service_2, biz.service_3, biz.service_4, biz.service_5, biz.service_6, biz.service_7, biz.service_8, biz.service_9, biz.service_10] %}
                          {{ services|select('string')|reject('equalto','')|join(', ') if services|select('string')|reject('equalto','')|list else 'N/A' }}
                        </small>
                      </div>
                    </div>
                  </div>
                  <!-- Large Listing Preview -->
                  <div class="p-2 border rounded bg-white">
                    <strong>Large Preview</strong>
                    <div class="mb-2">
                      {% if biz.profile_photo %}
                        <img src="{{ biz.profile_photo }}" class="rounded-circle mb-2" style="width:100px; height:100px; object-fit:cover;">
                      {% endif %}
                      <h4 class="mb-1">{{ biz.business_name }}</h4>
                      <div><b>Category:</b> {{ biz.category }}</div>
                      <div><b>Address:</b> {{ biz.address }}</div>
                      <div><b>Phone:</b> {{ biz.phone_number }}</div>
                      <div><b>Email:</b> {{ biz.business_email }}</div>
                      <div><b>Website:</b>
                        {% if biz.website_url %}
                          <a href="{{ biz.website_url }}" target="_blank">{{ biz.website_url }}</a>
                        {% else %} - {% endif %}
                      </div>
                      <div><b>About us:</b> {{ biz.about_us }}</div>
                      <div><b>Services:</b>
                        <ul style="padding-left: 20px;">
                          {%- for s in [biz.service_1, biz.service_2, biz.service_3, biz.service_4, biz.service_5, biz.service_6, biz.service_7, biz.service_8, biz.service_9, biz.service_10] if s %}
                            <li>{{ s }}</li>
                          {%- endfor %}
                          {% if not (biz.service_1 or biz.service_2 or biz.service_3 or biz.service_4 or biz.service_5 or biz.service_6 or biz.service_7 or biz.service_8 or biz.service_9 or biz.service_10) %}
                            <li>N/A</li>
                          {% endif %}
                        </ul>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-success text-center mt-4">
        No pending listings at this time.
      </div>
    {% endif %}
    <div class="text-center mt-4">
        <a href="{{ url_for('admin_roles_landing') }}" class="btn btn-secondary w-100 w-md-auto">Back to Admin Area</a>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>