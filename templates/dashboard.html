<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Welcome, {{ email }}!</h2>
        <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">Logout</a>
    </div>
    <div class="card p-4 mb-4">
        <h4>Your Referral Code:</h4>
        <code>{{ referral_code }}</code>
    </div>
    {% if sponsor %}
    <div class="card p-4 mb-4">
        <h4>Your Sponsor:</h4>
        <p class="mb-0">{{ sponsor }}</p>
    </div>
    {% endif %}
    <div class="card p-4 mb-4">
        <h4>Estimate Your Reward From Downline Purchases</h4>
        <form method="post" class="row g-3 mb-3">
            {{ form.hidden_tag() }}
            <div class="col-auto">
                {{ form.invoice_amount(class="form-control", placeholder="Purchase Amount (e.g. 500)", required=True) }}
                {% if form.invoice_amount.errors %}
                    <div class="text-danger small">{{ form.invoice_amount.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-auto">
                {{ form.downline_level(class="form-select", required=True) }}
                {% if form.downline_level.errors %}
                    <div class="text-danger small">{{ form.downline_level.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-auto">
                {{ form.submit(class="btn btn-primary") }}
            </div>
        </form>
        {{ rewards_table | safe }}
    </div>
    <div class="card p-4 mb-4">
        <h4>My Downline</h4>
        <div>
            <strong>Level 2 (direct referrals):</strong>
            {% if level2 %}
                <ul class="mb-2">{% for user in level2 %}<li>{{ user.email }} ({{ user.referral_code }})</li>{% endfor %}</ul>
            {% else %}
                <span>None</span>
            {% endif %}
        </div>
        <div>
            <strong>Level 3:</strong>
            {% if level3 %}
                <ul class="mb-2">{% for user in level3 %}<li>{{ user.email }} ({{ user.referral_code }})</li>{% endfor %}</ul>
            {% else %}
                <span>None</span>
            {% endif %}
        </div>
        <div>
            <strong>Level 4:</strong>
            {% if level4 %}
                <ul class="mb-2">{% for user in level4 %}<li>{{ user.email }} ({{ user.referral_code }})</li>{% endfor %}</ul>
            {% else %}
                <span>None</span>
            {% endif %}
        </div>
        <div>
            <strong>Level 5:</strong>
            {% if level5 %}
                <ul class="mb-2">{% for user in level5 %}<li>{{ user.email }} ({{ user.referral_code }})</li>{% endfor %}</ul>
            {% else %}
                <span>None</span>
            {% endif %}
        </div>
    </div>
    <div class="card p-4">
        <h4>This is your dashboard. ðŸŽ‰</h4>
        <p class="mb-0">Congrats on building a secure, styled Python web app!</p>
    </div>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-warning mt-3">
          {% for message in messages %}
            {{ message }}<br>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
</body>
</html>