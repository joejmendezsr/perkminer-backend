{% for msg in messages %}
  <div class="row {% if msg.sender_type == 'user' and is_user or msg.sender_type == 'business' and is_biz %}justify-content-end{% else %}justify-content-start{% endif %} mb-2">
    <div class="col-auto">
      <div class="{% if msg.sender_type == 'user' %}msg-bubble-user{% else %}msg-bubble-biz{% endif %}">
        <span class="fw-bold small {% if msg.sender_type == 'user' %}text-primary{% else %}text-success{% endif %}">
          {% if msg.sender_type == "user" %}
            {{ interaction.user.name or interaction.user.email }} (User)
          {% else %}
            {{ interaction.business.business_name }} (Business)
          {% endif %}
        </span>
        <span class="msg-time">{{ msg.timestamp.strftime('%Y-%m-%d %I:%M%p') }}</span>
        <div>{{ msg.text | e }}</div>
        {% if msg.file_url and msg.file_name and msg.file_name.lower().endswith(('.png','.jpg','.jpeg','.gif','.webp')) %}
          <a href="{{ msg.file_url }}" target="_blank">
            <img src="{{ msg.file_url }}" alt="{{ msg.file_name }}" class="chat-img-thumb">
          </a>
        {% elif msg.file_url %}
          <div class="mt-1">
            <a href="{{ msg.file_url }}" target="_blank">
              <span class="file-clip">&#128206;</span>{{ msg.file_name or "Download Attachment" }}
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% else %}
  <div class="text-center text-muted fst-italic mt-2">No messages yet. Start the conversation!</div>
{% endfor %}