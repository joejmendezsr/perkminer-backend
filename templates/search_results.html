<!DOCTYPE html>
<html>
<head>
    <title>Search Results - PerkMiner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<style>
:root {
  --pm-primary: #2a5859;
  --pm-accent: #ffd66b;
  --pm-bg: #fff;
  --pm-text: #222;
  --pm-hover: #e6f6f5;
  --pm-highlight: #f7ffe7;
  --pm-focus: #fadd92;
}
body {
  background: var(--pm-bg);
  color: var(--pm-text);
}
body > nav {
  margin-bottom: 2rem !important;
}
.navbar {
  box-shadow: 0 2px 8px #f0f2f3;
}
.card {
  border: none;
  opacity: 0;
  transform: translateY(30px);
  animation: fadeinCard 0.7s ease forwards;
}
@keyframes fadeinCard {
  to { opacity: 1; transform: none; }
}
.card .card-title { color: var(--pm-primary);}
.card:focus-within, .card:active {
  box-shadow: 0 4px 16px #b4dad9;
  outline: 2px solid var(--pm-focus);
}
.card:hover {
  background: var(--pm-hover);
  box-shadow: 0 4px 16px #b4dad9;
  transform: scale(1.045);
  z-index: 1;
  transition: background 0.18s, box-shadow 0.18s, transform 0.16s;
}

.category-icon, .biz-photo {
  font-size: 2.3em;
  margin-bottom: 8px;
  color: var(--pm-primary);
  display: block;
  border-radius: 50%;
  background: var(--pm-highlight);
  width: 72px;
  height: 72px;
  line-height: 72px;
  text-align: center;
  object-fit: cover;
  outline: 1px solid #e4eee9;
}
.biz-photo {
  background: #fff;
  border: 2px solid #daeae6;
}
.btn-primary, .btn-success {
  background: var(--pm-primary);
  border: none;
  color: #fff !important;
}
.btn-primary:hover, .btn-success:hover, .btn-outline-primary:focus {
  background: var(--pm-accent);
  color: var(--pm-text) !important;
}
.btn-outline-primary {
  border-color: var(--pm-primary);
  color: var(--pm-primary);
}
.btn-outline-primary:hover {
  background: var(--pm-primary);
  color: #fff;
}
a:focus, button:focus, input:focus {
  outline: 2px solid var(--pm-focus);
  outline-offset: 2px;
}
footer {
  background: #f8fafb;
  color: #999;
  padding: 1.5rem 0;
  margin-top: 3rem;
  text-align: center;
  font-size: 1em;
  border-top: 1px solid #e1e7ea;
}
.breadcrumb {
  background: none;
  padding-left: 0.5rem;
  margin-bottom: 1.5rem;
}
[aria-busy="true"] {
  opacity: 0.4;
  filter: blur(1px);
  pointer-events: none;
}
@media (max-width: 600px) {
  .card {
    min-width: 90vw !important;
    margin: 0 auto 12px auto;
  }
  .biz-photo, .category-icon {
    width: 58px;
    height: 58px;
    line-height: 58px;
    font-size: 1.6em;
  }
}
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container">
        <a class="navbar-brand" href="/">PerkMiner</a>
    </div>
</nav>
<main class="container">

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('home') }}">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Search</li>
      </ol>
    </nav>

    <h2 class="mb-4 text-center">Search Results</h2>
    {% if q %}
      <div class="mb-3 text-muted text-center">
        Showing results for: <strong>{{ q }}</strong>
        {% if category %} in <strong>{{ category }}</strong>{% endif %}
      </div>
    {% endif %}

    <!-- Accessibility-friendly Live Message for Count -->
    <div id="result-count-announcement" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

    {% set categories = [
      {'name':'Handyman-Contractor', 'icon':'wrench'},
      {'name':'Auto Parts & Service', 'icon':'car-front-fill'},
      {'name':'Home and Garden', 'icon':'house-door-fill'},
      {'name':'Retail Outlet', 'icon':'shop'},
      {'name':'Insurance', 'icon':'safe-fill'},
      {'name':'Restaurant', 'icon':'cup-straw'},
      {'name':'Real Estate', 'icon':'building'},
      {'name':'More', 'icon':'grid-3x3-gap'}
    ] %}
    {% if results and results|length > 0 %}
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="biz-results" aria-busy="false">
        {% for biz in results %}
          <div class="col">
            <div class="card h-100 shadow-sm" tabindex="0" aria-label="{{ biz.business_name }}">
              <div class="card-body text-center">
                {% if biz.profile_photo %}
                  <img src="{{ url_for('uploaded_file', filename=biz.profile_photo) }}" class="biz-photo mb-2" alt="{{ biz.business_name }} logo" width="70" height="70">
                {% else %}
                  <i class="bi bi-{{ categories | selectattr('name','equalto',biz.category) | map(attribute='icon') | list | first or 'grid-3x3-gap' }} category-icon" aria-hidden="true"></i>
                {% endif %}
                <h5 class="card-title mb-2" style="font-weight: bold;">{{ biz.business_name }}</h5>
                <div class="mb-1 small" style="font-weight: 500;">
                  <i class="bi bi-tag-fill" style="font-size:1em; color:var(--pm-primary);"></i>
                  {{ biz.category }}
                </div>
                {% if biz.website_url %}
                  <div class="mb-1"><strong>Website:</strong>
                    <a href="{{ biz.website_url }}" target="_blank" rel="noopener" style="word-break:break-all;">{{ biz.website_url }}</a>
                  </div>
                {% endif %}
                {% if biz.address %}
                  <div class="mb-1"><strong>Address:</strong> {{ biz.address }}</div>
                {% endif %}
                {% if biz.about_us %}
                  <div class="mb-1"><strong>About:</strong> {{ biz.about_us[:120] }}{% if biz.about_us|length > 120 %}...{% endif %}</div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <script>
        // Announce count for screen readers
        setTimeout(function() {
          var cnt = {{ results|length }};
          document.getElementById('result-count-announcement').textContent =
            (cnt === 1 ? '1 business found.' : cnt + ' businesses found.');
        }, 50);
      </script>
    {% else %}
      <div class="alert alert-warning text-center mt-4">
        <div class="mb-2" aria-label="No results icon">
          <i class="bi bi-search" style="font-size:2.7em;color:var(--pm-accent);"></i>
        </div>
        <div>No businesses found matching your search.</div>
        <div class="mt-3">
          <a href="{{ url_for('home') }}" class="btn btn-outline-primary mx-2 mb-2">Back to Home</a>
          <a href="{{ url_for('business_home') }}" class="btn btn-success mx-2 mb-2">Get Listed</a>
        </div>
        <div class="mt-2 text-muted small">
          Try different keywords, or <a href="{{ url_for('business_home') }}">advertise your business here</a>!
        </div>
      </div>
    {% endif %}
</main>
<footer>
  <div>
    <div class="mb-2">
      <a href="/" style="color:var(--pm-primary);font-weight:600;text-decoration:none;">PerkMiner</a> &copy; 2026
    </div>
    <div>
      <small>Need help? <a href="mailto:support@perkminer.com" style="color:var(--pm-primary);">Contact Support</a></small>
    </div>
    <div class="mt-1">
      <a href="#" style="color:#3dbbee; margin:0 6px;text-decoration:none;">Privacy</a>
      <a href="#" style="color:#3dbbee; margin:0 6px;text-decoration:none;">Terms</a>
    </div>
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // (Micro-interaction) Optionally: Add a loading effect on search submit
  var form = document.querySelector('form[action="{{ url_for("search") }}"]');
  if (form) {
    form.addEventListener('submit', function() {
      var resultsDiv = document.getElementById('biz-results');
      if (resultsDiv) {
        resultsDiv.setAttribute('aria-busy','true');
      }
    });
  }
</script>
</body>
</html>