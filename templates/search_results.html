<!DOCTYPE html>
<html>
<head>
    <title>Search Results - PerkMiner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
      :root {
        --pm-primary: #2a5859;
        --pm-accent: #ffd66b;
        --pm-bg: #fff;
        --pm-text: #222;
        --pm-hover: #e6f6f5;
        --pm-highlight: #f7ffe7;
        --pm-focus: #fadd92;
      }
      body { background: var(--pm-bg); color: var(--pm-text); }
      .navbar { box-shadow: 0 2px 8px #f0f2f3; }
      .card {
        border: none;
        opacity: 0;
        transform: translateY(30px);
        animation: fadeinCard 0.7s ease forwards;
        cursor: pointer;
        min-width: 190px;
      }
      @keyframes fadeinCard {
        to { opacity: 1; transform: none; }
      }
      .card .card-title { color: var(--pm-primary);}
      .card:focus-within, .card:active {
        box-shadow: 0 4px 16px #b4dad9;
        outline: 2px solid var(--pm-focus);
      }
      .card:hover {
        background: var(--pm-hover);
        box-shadow: 0 4px 16px #b4dad9;
        transform: scale(1.045);
        z-index: 1;
        transition: background 0.18s, box-shadow 0.18s, transform 0.16s;
      }
      .category-icon, .biz-photo {
        font-size: 2.3em;
        margin-bottom: 8px;
        color: var(--pm-primary);
        display: block;
        border-radius: 50%;
        background: var(--pm-highlight);
        width: 72px;
        height: 72px;
        line-height: 72px;
        text-align: center;
        object-fit: cover;
        outline: 1px solid #e4eee9;
      }
      .biz-photo {
        background: #fff;
        border: 2px solid #daeae6;
      }
      .miles-away-label {
        color: #888; 
        font-size: 0.97em; 
        margin-bottom: 2px;
      }
      .btn-primary, .btn-success { background: var(--pm-primary); border: none; color: #fff !important; }
      .btn-primary:hover, .btn-success:hover, .btn-outline-primary:focus { background: var(--pm-accent); color: var(--pm-text) !important; }
      .btn-outline-primary { border-color: var(--pm-primary); color: var(--pm-primary);}
      .btn-outline-primary:hover { background: var(--pm-primary); color: #fff;}
      footer { background: #f8fafb; color: #999; padding: 1.5rem 0; margin-top: 3rem; text-align: center; font-size: 1em; border-top: 1px solid #e1e7ea; }
      .breadcrumb { background: none; padding-left: 0.5rem; margin-bottom: 1.5rem;}
      [aria-busy="true"] { opacity: 0.4; filter: blur(1px); pointer-events: none; }
      @media (max-width: 900px) { .row-cols-lg-3 > * { flex: 0 0 100%; max-width: 100%; } }
      @media (max-width: 600px) {
        .card { min-width: 96vw !important; margin: 0 auto 12px auto; }
        .biz-photo, .category-icon { width: 58px; height: 58px; line-height: 58px; font-size: 1.5em;}
        .btn, .btn-outline-primary { width: 100%; margin-bottom:8px;}
        .breadcrumb { font-size: 1em; }
        h2 { font-size: 1.18em; }
      }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container">
        <a class="navbar-brand" href="/">PerkMiner</a>
    </div>
</nav>
<main class="container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('home') }}">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Search</li>
      </ol>
    </nav>

    <h2 class="mb-4 text-center">Search Results</h2>
    {% if q %}
      <div class="mb-3 text-muted text-center">
        Showing results for: <strong>{{ q }}</strong>
        {% if category %} in <strong>{{ category }}</strong>{% endif %}
      </div>
    {% endif %}

    <div id="result-count-announcement" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

    {% set categories = [
      {'name':'Handyman-Contractor', 'icon':'wrench'},
      {'name':'Auto Parts & Service', 'icon':'car-front-fill'},
      {'name':'Home and Garden', 'icon':'house-door-fill'},
      {'name':'Retail Outlet', 'icon':'shop'},
      {'name':'Insurance', 'icon':'safe-fill'},
      {'name':'Restaurant', 'icon':'cup-straw'},
      {'name':'Real Estate', 'icon':'building'},
      {'name':'More', 'icon':'grid-3x3-gap'}
    ] %}
    {% if results and results|length > 0 %}
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="biz-results" aria-busy="false">
        {% for biz in results %}
          <div class="col">
            <div class="card h-100 shadow-sm small-listing-card"
                tabindex="0" aria-label="{{ biz.business_name }}"
                onclick="window.location.href='{{ url_for('view_listing', biz_id=biz.id) }}'">
              <div class="card-body text-center">
                {% if biz.profile_photo %}
                  <img src="{{ biz.profile_photo }}" class="biz-photo mb-2" alt="{{ biz.business_name }} logo" width="70" height="70">
                {% else %}
                  <i class="bi bi-{{ categories | selectattr('name','equalto',biz.category) | map(attribute='icon') | list | first or 'grid-3x3-gap' }} category-icon" aria-hidden="true"></i>
                {% endif %}
                <h5 class="card-title mb-2" style="font-weight: bold;">{{ biz.business_name }}</h5>
                {% if biz.distance_mi is defined and biz.distance_mi is not none %}
                  <div class="miles-away-label">
                    <i class="bi bi-geo-alt-fill"></i>
                    {{ biz.distance_mi }} miles away
                  </div>
                {% endif %}
                <div class="mb-1 small" style="font-weight: 500;">
                  <i class="bi bi-tag-fill" style="font-size:1em; color:var(--pm-primary);"></i>
                  {{ biz.category }}
                </div>
                {% if biz.address %}
                  <div class="mb-1"><strong>Address:</strong> {{ biz.address }}</div>
                {% endif %}
                <div class="mb-1">
                  <strong>Services:</strong>
                  {% set services = [biz.service_1, biz.service_2, biz.service_3, biz.service_4, biz.service_5, biz.service_6, biz.service_7, biz.service_8, biz.service_9, biz.service_10] %}
                  {{ services|select('string')|reject('equalto','')|join(', ') if services|select('string')|reject('equalto','')|list else 'N/A' }}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <script>
        setTimeout(function() {
          var cnt = {{ results|length }};
          document.getElementById('result-count-announcement').textContent =
            (cnt === 1 ? '1 business found.' : cnt + ' businesses found.');
        }, 50);
      </script>
    {% else %}
      <div class="alert alert-warning text-center mt-4">
        <div class="mb-2" aria-label="No results icon">
          <i class="bi bi-search" style="font-size:2.7em;color:var(--pm-accent);"></i>
        </div>
        <div>No businesses found matching your search.</div>
        <div class="mt-3">
          <a href="{{ url_for('home') }}" class="btn btn-outline-primary mx-2 mb-2">Back to Home</a>
          <a href="{{ url_for('business_home') }}" class="btn btn-success mx-2 mb-2">Get Listed</a>
        </div>
        <div class="mt-2 text-muted small">
          Try different keywords, or <a href="{{ url_for('business_home') }}">advertise your business here</a>!
        </div>
      </div>
    {% endif %}
</main>
<footer>
  <div>
    <div class="mb-2">
      <a href="/" style="color:var(--pm-primary);font-weight:600;text-decoration:none;">PerkMiner</a> &copy; 2026
    </div>
    <div>
      <small>Need help? <a href="mailto:support@perkminer.com" style="color:var(--pm-primary);">Contact Support</a></small>
    </div>
    <div class="mt-1">
      <a href="#" style="color:#3dbbee; margin:0 6px;text-decoration:none;">Privacy</a>
      <a href="#" style="color:#3dbbee; margin:0 6px;text-decoration:none;">Terms</a>
    </div>
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  var form = document.querySelector('form[action="{{ url_for("search") }}"]');
  if (form) {
    form.addEventListener('submit', function() {
      var resultsDiv = document.getElementById('biz-results');
      if (resultsDiv) {
        resultsDiv.setAttribute('aria-busy','true');
      }
    });
  }
</script>
</body>
</html>