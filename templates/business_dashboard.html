<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - PerkMiner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
:root {
  --pm-primary: #2a5859;
  --pm-accent: #ffd66b;
  --pm-bg: #fff;
  --pm-text: #222;
  --pm-hover: #e6f6f5;
  --pm-focus: #fadd92;
}
body {
  background: var(--pm-bg);
  color: var(--pm-text);
}
body > nav {
  margin-bottom: 2rem !important;
}
.navbar {
  box-shadow: 0 2px 8px #f0f2f3;
}
.card, .dashboard-section {
  background: #f8fafb;
  border-radius: 16px;
  box-shadow: 0 2px 16px #e3eee9;
  margin-bottom: 1.5rem;
  transition: box-shadow 0.2s;
}
.card:hover, .dashboard-section:hover {
  box-shadow: 0 6px 24px #d2eced;
}
.profile-pic {
  width: 84px;
  height: 84px;
  object-fit: cover;
  border-radius: 50%;
  background: var(--pm-hover);
  border: 2px solid var(--pm-primary);
}
.placeholder-pic {
  width: 84px; height: 84px; border-radius: 50%;
  background: #e6f6f5;
  color: var(--pm-primary);
  display: flex; align-items: center; justify-content: center;
  font-size: 2.4em;
  border: 2px solid var(--pm-primary);
}
.btn-primary, .btn-success {
  background: var(--pm-primary);
  border: none;
  color: #fff !important;
}
.btn-primary:hover, .btn-success:hover {
  background: var(--pm-accent);
  color: var(--pm-text) !important;
}
.btn-outline-danger {
  border-color: #bf3636;
  color: #bf3636 !important;
}
.btn-outline-danger:hover {
  background: #bf3636;
  color: #fff !important;
}
a:focus, button:focus, input:focus {
  outline: 2px solid var(--pm-focus);
  outline-offset: 2px;
}
.input-group, .form-control, .form-select {
  border-radius: 10px !important;
}
label { font-weight: 500; }
.pointer { cursor: pointer; }
@media (max-width: 600px) {
  .card, .dashboard-section {
    padding: 1rem;
  }
  .profile-pic, .placeholder-pic {
    width: 60px;
    height: 60px;
    font-size: 1.5em;
  }
}
footer {
  background: #f8fafb;
  color: #999;
  padding: 1.5rem 0;
  margin-top: 3rem;
  text-align: center;
  font-size: 1em;
  border-top: 1px solid #e1e7ea;
}

   #map {
  width: 100%;
  height: 300px !important;
  min-height: 300px !important;
  border-radius: 8px;
  margin-bottom: 12px;
}
 </style>
    <script>
      function calculateNetworkEarnings() {
        let numPeople = parseInt(document.getElementById('network_people').value, 10) || 0;
        let amount = parseFloat(document.getElementById('network_amount').value) || 0;
        if (amount > 2500) amount = 2500;
        document.getElementById('network_amount').value = amount;
        let t1 = 0.02 * amount;
        let t2 = 0.0025 * amount * numPeople;
        let t3 = 0.0025 * amount * Math.pow(numPeople, 2);
        let t4 = 0.0025 * amount * Math.pow(numPeople, 3);
        let t5 = 0.02 * amount * Math.pow(numPeople, 4);
        let total = t1 + t2 + t3 + t4 + t5;
        document.getElementById('network_t1').innerText = t1.toFixed(2);
        document.getElementById('network_t2').innerText = t2.toFixed(2);
        document.getElementById('network_t3').innerText = t3.toFixed(2);
        document.getElementById('network_t4').innerText = t4.toFixed(2);
        document.getElementById('network_t5').innerText = t5.toFixed(2);
        document.getElementById('network_total').innerText = total.toFixed(2);
        document.getElementById('network_results').style.display = 'block';
      }
      function calculateSingleReward() {
        let amount = parseFloat(document.getElementById('reward_amount').value) || 0;
        if (amount > 2500) amount = 2500;
        document.getElementById('reward_amount').value = amount;
        let tier = document.getElementById('reward_tier').value;
        let reward = 0;
        let desc = "";
        let cap = null;
        if (tier === "1") {
            reward = amount * 0.02; desc = "As the customer, from a purchase you make";
        } else if (["2","3","4"].includes(tier)) {
            reward = amount * 0.0025;
            cap = 6.25;
            if (reward > cap) reward = cap;
            desc = `If your Tier ${tier} referral makes a purchase`;
        } else if (tier === "5") {
            reward = amount * 0.02;
            cap = 50;
            if (reward > cap) reward = cap;
            desc = "If your Tier 5 referral makes a purchase";
        }
        let out = '';
        if (amount > 0) {
          out += `<h5 class='mt-4 mb-2'>${desc} of $${amount.toFixed(2)}:</h5>`;
          out += `<div class='alert alert-success'>You earn <strong>$${reward.toFixed(2)}</strong> as cashback${cap?` (capped at $${cap.toFixed(2)}).`:"."}</div>`;
        }
        document.getElementById('rewards_output').innerHTML = out;
      }
    </script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
    <div class="container">
        <a class="navbar-brand" href="/">PerkMiner</a>
        <div class="navbar-nav ms-auto">
            <span class="nav-link disabled">{{ email }}</span>
            <a class="nav-link" href="{{ url_for('business_logout') }}">Logout</a>
        </div>
    </div>
</nav>
<div class="container py-4">
  <div class="card mb-4 p-4">
  <div class="d-flex align-items-center flex-wrap mb-3">
    {% if profile_img_url %}
      <img src="{{ profile_img_url }}" alt="Profile Photo" class="profile-pic me-3">
    {% else %}
      <div class="placeholder-pic me-3"><i class="bi bi-person"></i></div>
    {% endif %}
    <div>
      <h2 class="mb-0">
        Welcome, {{ biz.business_name if biz.business_name else (user_name if user_name else email) }}!
      </h2>
    </div>
    <div class="ms-auto d-flex gap-2 flex-wrap">
      <a href="{{ url_for('business_logout') }}" class="btn btn-outline-danger">Logout</a>
    </div>
  </div>

    <!-- Invite Others Button -->
<div class="card p-4 mb-4">
  <div class="mb-3">
    <button class="btn btn-success w-100" type="button" data-bs-toggle="modal" data-bs-target="#inviteModal">
      <i class="bi bi-person-plus me-1"></i>Invite others to join
    </button>
  </div>
  <div>
    <button class="btn btn-primary w-100" type="button"
      data-bs-toggle="collapse"
      data-bs-target="#profileCollapse"
      aria-expanded="false"
      aria-controls="profileCollapse">
      View/Edit Profile
    </button>
  </div>
</div>
    <!-- Invite Modal -->
    <div class="modal fade" id="inviteModal" tabindex="-1" aria-labelledby="inviteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" method="post" action="{{ url_for('business_invite') }}">
          {{ invite_form.hidden_tag() }}
          <div class="modal-header">
            <h5 class="modal-title" id="inviteModalLabel">Invite Others to Join PerkMiner</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <label for="invitee-email" class="form-label">Recipient's Email Address:</label>
            {{ invite_form.invitee_email(class="form-control", id="invitee-email", placeholder="Enter email to invite", required=True) }}
          </div>
          <div class="modal-footer">
            {{ invite_form.submit(class="btn btn-primary") }}
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Profile Edit Section -->
    <div class="collapse mb-4" id="profileCollapse">
      <div class="card p-4">
        <h4>Your Profile</h4>
<form method="post" enctype="multipart/form-data" class="row g-3 align-items-center" id="profile-form">
  {{ profile_form.hidden_tag() }}
  <!-- Profile Photo -->
  <div class="col-12 mb-3 text-center">
    {% if profile_img_url %}
      <img src="{{ profile_img_url }}" alt="Profile Photo" class="rounded-circle profile-pic">
    {% else %}
      <div class="placeholder-pic">No Image</div>
    {% endif %}
    <input type="file" name="profile_photo" accept="image/*" class="form-control mt-2">
  </div>

  <!-- Business Name -->
  <div class="col-12 mb-3">
    <label class="form-label">Business Name</label>
    {{ profile_form.business_name(class="form-control", value=biz.business_name, placeholder="Enter your business name") }}
  </div>

  <!-- Phone Number -->
  <div class="col-12 mb-3">
    <label class="form-label">Phone Number</label>
    {{ profile_form.phone_number(class="form-control", id="us-phone", value=phone_number, placeholder="(555) 555-5555") }}
    <div class="form-text">Format: (555) 555-5555</div>
  </div>

  <!-- Business Address + Map -->
  <div class="col-12 mb-3">
    <label class="form-label">Business Address</label>
    {{ profile_form.address(class="form-control", id="address-autocomplete", value=address, placeholder="Business address", autocomplete="off") }}
    <input type="hidden" name="latitude" id="latitude" value="{{ latitude or '' }}">
    <input type="hidden" name="longitude" id="longitude" value="{{ longitude or '' }}">
    <label class="form-label mt-2 mb-1 d-block">Pin or change your location on the map below:</label>
    <div id="map"></div>
  </div>
<div class="col-12 mb-3">
  <label class="form-label">Website</label>
  <input type="url" class="form-control" id="website_url" name="website_url" maxlength="255"
         value="{{ biz.website_url or '' }}" placeholder="https://your-website.com">
</div>
  <!-- Services Offered Collapse -->
  <div class="col-12 mt-3">
   <a class="pointer fw-semibold text-primary" data-bs-toggle="collapse" href="#servicesCollapse" aria-expanded="false" aria-controls="servicesCollapse">
      Products or Services Offered
    </a>
    <div class="collapse mt-2" id="servicesCollapse">
      <div id="services-list">
        {% set services = [
          biz.service_1 or '',
          biz.service_2 or '',
          biz.service_3 or '',
          biz.service_4 or '',
          biz.service_5 or '',
          biz.service_6 or '',
          biz.service_7 or '',
          biz.service_8 or '',
          biz.service_9 or '',
          biz.service_10 or ''
        ] %}
        {% for s in range(0, 10) %}
          {% if services[s] or s < 2 %}
            <div class="input-group mb-2 service-field" data-index="{{ s }}">
              <input type="text" class="form-control" name="service_{{ s+1 }}" maxlength="100" placeholder="Service #{{ s+1 }}" value="{{ services[s] }}">
              <button class="btn btn-outline-danger service-remove" type="button" onclick="removeService(this)" {% if s < 2 %}disabled{% endif %}>&minus;</button>
            </div>
          {% endif %}
        {% endfor %}
      </div>
      <button class="btn btn-outline-primary" type="button" id="addServiceBtn">+ Add Service</button>
      <small class="text-muted d-block mt-1">Max 10 services.</small>
    </div>
  </div>
<div class="col-12 mb-3">
  <label class="form-label">About Us</label>
  <textarea class="form-control" id="about_us" name="about_us" rows="3" maxlength="1000" placeholder="Write about your business (max 1000 characters)">{{ biz.about_us or '' }}</textarea>
  <div class="form-text">Recommended: up to 500 characters. Max: 1000.</div>
</div>
<div class="col-12 mb-3">
  <label class="form-label">Category</label>
  <select class="form-select" name="category" id="business_category" required>
    <option value="">Select category...</option>
    <option value="Handyman-Contractor" {% if biz.category == 'Handyman-Contractor' %}selected{% endif %}>Handyman-Contractor</option>
    <option value="Auto Parts & Service" {% if biz.category == 'Auto Parts & Service' %}selected{% endif %}>Auto Parts & Service</option>
    <option value="Home and Garden" {% if biz.category == 'Home and Garden' %}selected{% endif %}>Home and Garden</option>
    <option value="Retail Outlet" {% if biz.category == 'Retail Outlet' %}selected{% endif %}>Retail Outlet</option>
    <option value="Professional Services" {% if biz.category == 'Professional Services' %}selected{% endif %}>Professional Services</option>
    <option value="Restaurant" {% if biz.category == 'Restaurant' %}selected{% endif %}>Restaurant</option>
    <option value="Real Estate" {% if biz.category == 'Real Estate' %}selected{% endif %}>Real Estate</option>
  </select>
</div>
  <!-- Keywords -->
  <div class="col-12 mt-3">
    <label class="form-label">Keywords (for search, separated by commas)</label>
    <input type="text" class="form-control" id="search_keywords" name="search_keywords" maxlength="500" value="{{ biz.search_keywords or '' }}" placeholder="e.g. roofing,solar,energy">
    <div class="form-text">Up to 20 keywords (comma-separated).</div>
  </div>

  <!-- Preview and Save Buttons -->
  <div class="col-12 mt-3 d-flex gap-2">
    <button type="button" class="btn btn-secondary" id="previewListingBtn">Preview Listing</button>
    {{ profile_form.submit(class="btn btn-success") }}
  </div>
</form>
      </div>
    </div>
  </div>
  <!-- Referral Code Section -->
  <div class="card p-4 mb-4">
    <h4>Your Referral Code</h4>
    <div class="mb-0"><b>{{ referral_code }}</b></div>
  </div>
      {% if sponsor %}
        <div class="card p-4 mb-4">
          <div><small class="text-muted">Sponsored by: <span class="text-success">{{ sponsor.business_name }}</span></small></div>
        </div>
      {% endif %}
  <div class="card p-4 mb-4">
    <h4>Estimate Your Rewards From One Single Purchase</h4>
    <div class="row g-3 mb-3">
      <div class="col-12 col-md-auto">
        <input id="reward_amount" type="number" class="form-control" placeholder="Amount (e.g. 500)" max="2500" required>
      </div>
      <div class="col-12 col-md-auto">
        <select id="reward_tier" class="form-select" required>
            <option value="1" selected>Tier 1 (your purchases)</option>
            <option value="2">Tier 2 (direct referral purchases)</option>
            <option value="3">Tier 3 (Tier 2 referral purchases)</option>
            <option value="4">Tier 4 (Tier 3 referral purchases)</option>
            <option value="5">Tier 5 (Tier 4 referral purchases)</option>
        </select>
      </div>
      <div class="col-12 col-md-auto">
        <button type="button" class="btn btn-primary" onclick="calculateSingleReward()">Calculate My Reward</button>
      </div>
    </div>
    <div id="rewards_output">
      {{ rewards_table | safe }}
    </div>
  </div>

  <div class="card p-4 mb-4">
    <h4>Referral Network Cashback Calculator (one purchase from everyone in your network during the month)</h4>
    <div class="mb-2">
      <label>If you and everyone in your network refers 
        <input id="network_people" type="number" class="form-control d-inline-block w-auto" min="1" value="2" style="width:80px;" />
        people and you each make one purchase during the month in the amount of $ 
        <input id="network_amount" type="number" class="form-control d-inline-block w-auto" min="0" max="2500" step="0.01" value="100" style="width:110px;" />
        , this is how much you would earn in Cashback Rewards for the month:
      </label>
      <small class="text-muted d-block">*Maximum purchase amount allowed is $2,500</small>
    </div>
    <button class="btn btn-info mb-2" type="button" onclick="calculateNetworkEarnings()">Calculate</button>
    <div id="network_results" style="display:none;">
      <ul class="mb-1">
        <li>Tier One: (Your purchases) = <span id="network_t1"></span></li>
        <li>Tier Two: (Purchases from your direct referrals) = <span id="network_t2"></span></li>
        <li>Tier Three: (Purchases from 2nd Tier referrals) = <span id="network_t3"></span></li>
        <li>Tier Four: (Purchases from 3rd Tier referrals) = <span id="network_t4"></span></li>
        <li>Tier Five: (Purchases from 4th Tier referrals) = <span id="network_t5"></span></li>
      </ul>
      <strong>Your total cashback earnings for the month would be $<span id="network_total"></span></strong>
    </div>
  </div>
  <div class="card p-4 mb-4">
    <h4>My Network</h4>
    <div>
      <a role="button" class="fw-semibold text-primary" data-bs-toggle="collapse" href="#tier2" aria-expanded="false" aria-controls="tier2">
        Tier 2 (direct referrals)
      </a>
      <div class="collapse mt-2" id="tier2">
        {% if level2 %}
          <ul class="mb-2">{% for user in level2 %}<li>{{ user.email }} ({{ user.referral_code }})</li>{% endfor %}</ul>
        {% else %}
          <span>None</span>
        {% endif %}
      </div>
    </div>
    <div>
      <a role="button" class="fw-semibold text-primary" data-bs-toggle="collapse" href="#tier3" aria-expanded="false" aria-controls="tier3">
        Tier 3 (referred by Tier 2 people)
      </a>
      <div class="collapse mt-2" id="tier3">
        {% if level3 %}
          <ul class="mb-2">{% for user in level3 %}<li>{{ user.email }} ({{ user.referral_code }})</li>{% endfor %}</ul>
        {% else %}
          <span>None</span>
        {% endif %}
      </div>
    </div>
    <div>
      <a role="button" class="fw-semibold text-primary" data-bs-toggle="collapse" href="#tier4" aria-expanded="false" aria-controls="tier4">
        Tier 4 (referred by Tier 3 people)
      </a>
      <div class="collapse mt-2" id="tier4">
        {% if level4 %}
          <ul class="mb-2">{% for user in level4 %}<li>{{ user.email }} ({{ user.referral_code }})</li>{% endfor %}</ul>
        {% else %}
          <span>None</span>
        {% endif %}
      </div>
    </div>
    <div>
      <a role="button" class="fw-semibold text-primary" data-bs-toggle="collapse" href="#tier5" aria-expanded="false" aria-controls="tier5">
        Tier 5 (referred by Tier 4 people)
      </a>
      <div class="collapse mt-2" id="tier5">
        {% if level5 %}
          <ul class="mb-2">{% for user in level5 %}<li>{{ user.email }} ({{ user.referral_code }})</li>{% endfor %}</ul>
        {% else %}
          <span>None</span>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="card p-4 text-center">
    <h4>This is your dashboard.</h4>
    <p class="mb-0">Congrats on building a secure, styled Python web app!</p>
  </div>
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-warning mt-3">
        {% for message in messages %}
          {{ message }}<br>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

</div>
<footer>
  <div>
    <div class="mb-2">
      <a href="/" style="color:var(--pm-primary);font-weight:600;text-decoration:none;">PerkMiner</a> &copy; 2026
    </div>
    <div>
      <small>Need help? <a href="mailto:support@perkminer.com" style="color:var(--pm-primary);">Contact Support</a></small>
    </div>
    <div class="mt-1">
      <a href="#" style="color:#3dbbee; margin:0 6px;text-decoration:none;">Privacy</a>
      <a href="#" style="color:#3dbbee; margin:0 6px;text-decoration:none;">Terms</a>
    </div>
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
let marker, map, autocomplete;
function initMap() {
    const latInput = document.getElementById('latitude');
    const lngInput = document.getElementById('longitude');
    let lat = parseFloat(latInput.value) || 39.8283;  // center on USA if blank
    let lng = parseFloat(lngInput.value) || -98.5795;
    let center = {lat: lat, lng: lng};
    map = new google.maps.Map(document.getElementById('map'), {
        zoom: (latInput.value && lngInput.value) ? 16 : 4,
        center: center
    });
    marker = new google.maps.Marker({
        position: center,
        map: map,
        draggable: true
    });
    google.maps.event.addListener(marker, 'dragend', function(event) {
        latInput.value = event.latLng.lat();
        lngInput.value = event.latLng.lng();
    });
    // Click on map moves marker
    map.addListener && map.addListener('click', function(e) {
        marker.setPosition(e.latLng);
        latInput.value = e.latLng.lat();
        lngInput.value = e.latLng.lng();
    });
    // Address autocomplete
    const input = document.getElementById('address-autocomplete');
    if (input) {
      autocomplete = new google.maps.places.Autocomplete(input, { types: ['geocode'] });
      autocomplete.addListener('place_changed', function () {
          const place = autocomplete.getPlace();
          if (!place.geometry) return;
          const loc = place.geometry.location;
          latInput.value = loc.lat();
          lngInput.value = loc.lng();
          marker.setPosition(loc);
          map.setCenter(loc);
          map.setZoom(16);
      });
    }
}
</script>
<script>
window.addEventListener('DOMContentLoaded', function() {
  let previewBtn = document.getElementById('previewListingBtn');
  let modal = document.getElementById('listingPreviewModal');
  let modalContent = document.getElementById('listing-preview-content');
  let previewModal = modal && window.bootstrap ? new bootstrap.Modal(modal) : null;

  previewBtn && previewBtn.addEventListener('click', function(){
    let name = document.querySelector('[name="business_name"]')?.value || "{{ biz.business_name }}";
    let address = document.getElementById('address-autocomplete')?.value || "{{ biz.address }}";
    let category = document.getElementById('business_category')?.value || "{{ biz.category }}";
    let phone = document.getElementById('us-phone')?.value || "{{ biz.phone_number }}";
    let website = document.getElementById('website_url')?.value || "{{ biz.website_url }}";
    let about = document.getElementById('about_us')?.value || "{{ biz.about_us }}";
    let keywords = document.getElementById('search_keywords')?.value || "{{ biz.search_keywords }}";
// For services, youâ€™ll need to loop Jinja or parse inputs

let services = [];
document.querySelectorAll('#services-list input').forEach(input => {
  if(input.value.trim()!="") services.push(input.value.trim());
});

    let img = '{{ profile_img_url if profile_img_url else "" }}';

    let smallListing = `
  <div class="card mb-3">
    <div class="row g-0 align-items-center">
      <div class="col-md-3 text-center">
        ${img? `<img src="${img}" class="rounded-circle" style="width:60px;height:60px;object-fit:cover;">` : ""}
      </div>
      <div class="col-md-9">
        <b>${name}</b><br/>
        <span class="text-muted">${category}</span><br/>
        <span>${address}</span><br/>
        <small>Services: ${services.length ? services.join(', ') : 'N/A'}</small>
      </div>
    </div>
  </div>
`;

    let largeListing = `
  <div>
    ${img? `<div class="mb-3 text-center"><img src="${img}" class="rounded-circle" style="width:120px;height:120px;object-fit:cover;"></div>` : ""}
    <h3>${name}</h3>
    <div><strong>Category:</strong> ${category}</div>
    <div><strong>Address:</strong> ${address}</div>
    <div id="preview-map" style="width:100%;height:150px;border-radius:8px;margin:8px 0;"></div>
    <div><strong>Phone:</strong> ${phone}</div>
    <div><strong>Website:</strong> ${website? `<a href="${website}" target="_blank">${website}</a>` : '-'}</div>
    <div><strong>Email:</strong> {{ biz.business_email }}</div>
    <div><strong>About us:</strong> ${about}</div>
    <div><strong>Services:</strong> ${services.length ? "<ul>" + services.map(s=>`<li>${s}</li>`).join('') + "</ul>" : "N/A"}</div>
  </div>
`;

// Display the cards in your modal
    let html = `
  <div>
    <h5>Small Listing Preview</h5>
    ${smallListing}
    <hr/>
    <h5>Large Listing Preview</h5>
    ${largeListing}
  </div>
`;

modalContent.innerHTML = html;

// Add map rendering logic inside the preview modal if you want (see below)


    modalContent.innerHTML = html;
// Render a mini map in preview if there is a lat/lng
setTimeout(function() {
  let lat = Number(document.getElementById('latitude')?.value) || 39.8283;
  let lng = Number(document.getElementById('longitude')?.value) || -98.5795;

  if (window.google && document.getElementById('preview-map')) {
    let previewMap = new google.maps.Map(document.getElementById('preview-map'), {
      center: {lat: lat, lng: lng},
      zoom: 16
    });
    new google.maps.Marker({position: {lat: lat, lng: lng}, map: previewMap});
  }
}, 200);
    previewModal && previewModal.show();
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const servicesList = document.getElementById('services-list');
  const addBtn = document.getElementById('addServiceBtn');

  addBtn.addEventListener('click', function() {
    // Count current fields
    const count = servicesList.querySelectorAll('.service-field').length;
    if (count >= 10) return; // Max 10

    // Create new service input group
    const div = document.createElement('div');
    div.className = 'input-group mb-2 service-field';
    div.setAttribute('data-index', count);

    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'form-control';
    input.name = 'service_' + (count + 1);
    input.maxLength = 100;
    input.placeholder = 'Service #' + (count + 1);

    const btn = document.createElement('button');
    btn.className = 'btn btn-outline-danger service-remove';
    btn.type = 'button';
    btn.innerHTML = '&minus;';
    btn.addEventListener('click', function() {
      if (servicesList.querySelectorAll('.service-field').length > 2) {
        div.remove();
      }
    });
    // Disable remove for first two fields
    if (count < 2) btn.disabled = true;

    div.appendChild(input);
    div.appendChild(btn);
    servicesList.appendChild(div);
  });

  // Re-enable remove buttons for >2 fields
  servicesList.querySelectorAll('.service-field .service-remove').forEach(function(btn, idx) {
    if (idx >= 2) btn.disabled = false;
    btn.addEventListener('click', function() {
      if (servicesList.querySelectorAll('.service-field').length > 2) {
        btn.parentElement.remove();
      }
    });
  });
});
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDo-AojTUQUwwvvywrSiDRcF-oVpw9m_w4&libraries=places&callback=initMap" async defer></script>
<div class="modal fade" id="listingPreviewModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Profile Preview</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="listing-preview-content"></div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>