<!DOCTYPE html>
<html>
<head>
  <title>PerkMiner Homepage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    :root {
      --pm-primary: #2a5859;
      --pm-accent: #ffd66b;
      --pm-bg: #ffffff;
      --pm-text: #222;
      --pm-hover: #e6f6f5;
    }
    body {
      background: var(--pm-bg);
      color: var(--pm-text);
    }
    .navbar {
      box-shadow: 0 2px 8px #f0f2f3;
    }
    .navbar-brand img {
      height: 38px;
      width: auto;
      max-width: 140px;
      object-fit: contain;
      display: inline-block;
      vertical-align: middle;
    }
    .totals-section {
      margin-top: 1.88rem;
      margin-bottom: .7rem;
    }
    .totals-card {
      background: #fff;
      border: 1px solid #e7ebed;
      box-shadow: 0 2px 10px #e6f4ee;
      border-radius: 13px;
      padding: 1rem 1.7rem;
      min-height: 90px;
    }
    .totals-card .totals-label {
      font-size: 1.08em;
      color: var(--pm-primary);
      font-weight: 600;
      margin-bottom: 0.3rem;
    }
    .totals-card .totals-value {
      font-size: 1.45em;
      font-weight: 700;
    }
    /* Hero and rest as before... */
    .hero-section {
      min-height: 55vh;
      background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=60') center/cover no-repeat;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hero-section .overlay {
      position: absolute;
      inset: 0;
      background: rgba(42,88,89,.53);
      z-index: 1;
    }
    .hero-content {
      position: relative;
      z-index: 2;
      width: 100%;
      max-width: 620px;
      margin: 0 auto;
      color: #fff;
    }
    .hero-content h1 {
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(34,40,39,0.15);
    }
    .search-form .input-group {
      border-radius: 18px;
      box-shadow: 0 2px 10px #f2f5f5;
      background: #fff;
      overflow: hidden;
    }
    .search-form .form-control, .search-form .btn {
      border-radius: 18px !important;
      font-size: 1.1em;
    }
    .category-card {
      border-radius: 10px;
      overflow: hidden;
      border: none;
      box-shadow: 0 3px 10px #d1e7e0;
      transition: transform 0.17s, box-shadow 0.17s;
      cursor: pointer;
      background: #fff;
      min-height: 126px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4px;
      opacity: 0.97;
    }
    .category-card:hover, .category-card:focus-within {
      transform: scale(1.038);
      box-shadow: 0 7px 28px #aacfc6;
      background: var(--pm-hover);
    }
    .category-image {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 7px;
      box-shadow: 0 2px 8px #ddebe8;
      background: #fff;
    }
    .category-label {
      font-size: 1.07em;
      color: var(--pm-primary);
      font-weight: 500;
      text-align: center;
    }
    @media (max-width: 767px) {
      .category-card {
        min-height: 110px;
      }
    }
    @media (max-width: 575px) {
      .hero-section {
        min-height: 41vh;
      }
      .category-card {
        min-height: 90px;
      }
    }
    .card.business-listing {
      border: none;
      box-shadow: 0 2px 10px #deedea;
      margin-bottom: 1.2em;
    }
    .business-listing .category-image {
      width: 36px;
      height: 36px;
      margin-bottom: 3px;
    }
    footer {
      background: #f8fafb;
      color: #999;
      padding: 1.5rem 0;
      margin-top: 3rem;
      text-align: center;
      font-size: 1em;
      border-top: 1px solid #e1e7ea;
    }
    .dashboard-btn-wrap {
      text-align: right;
      margin-top: 1.1rem;
      margin-bottom: -1.3rem;
    }
  </style>
</head>
<body>

  {% if current_user.is_authenticated %}
    <div class="container dashboard-btn-wrap">
      {% if current_user.business_email %}
        <a href="{{ url_for('business_dashboard') }}" class="btn btn-warning">Return to Dashboard</a>
      {% else %}
        <a href="{{ url_for('dashboard') }}" class="btn btn-warning">Return to Dashboard</a>
      {% endif %}
    </div>
  {% elif session.get('business_id') %}
    <div class="container dashboard-btn-wrap">
      <a href="{{ url_for('business_dashboard') }}" class="btn btn-warning">Return to Dashboard</a>
    </div>
  {% endif %}

  <nav class="navbar navbar-expand-lg navbar-light bg-light mb-0">
    <div class="container">
      <a class="navbar-brand" href="/">
        <img src="/static/logo.png" alt="Your Business Logo">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="/login">Login</a>
          <a class="nav-link" href="/register">Register</a>
          <a class="nav-link" href="/business">Advertise with Us</a>
        </div>
      </div>
    </div>
  </nav>
  <section class="hero-section">
    <div class="overlay"></div>
    <div class="container hero-content text-center">
      <h1 class="mb-3">Welcome to PerkMiner</h1>
      <form class="search-form mb-4" method="get" action="/search">
        <div class="input-group mb-2">
          <input type="text" class="form-control" name="q" placeholder="Search for products, services, or businesses..." aria-label="Search">
          <select class="form-select" name="distance" style="max-width:110px;">
            <option value="">Closest</option>
            <option value="5">5 mi</option>
            <option value="10">10 mi</option>
            <option value="25">25 mi</option>
            <option value="all">All</option>
          </select>
          <button class="btn btn-primary" type="submit">Search</button>
        </div>
        <input type="hidden" name="lat" id="search-lat">
        <input type="hidden" name="lng" id="search-lng">
      </form>
      <!-- --- LIVE TOTALS SECTION --- -->
      <div class="container totals-section">
        <div class="row justify-content-center g-2">
          <div class="col-12 col-md-4 mb-2">
            <div class="totals-card">
              <div class="totals-label">Member Cash Back and Commissions Paid To Date:</div>
              <div class="totals-value text-success">${{ "{:,.2f}".format(total_member_paid|default(0, true)) }}</div>
            </div>
          </div>
          <div class="col-12 col-md-4 mb-2">
            <div class="totals-card">
              <div class="totals-label">Business Cash Back Paid To Date:</div>
              <div class="totals-value text-primary">${{ "{:,.2f}".format(total_biz_paid|default(0, true)) }}</div>
            </div>
          </div>
          <div class="col-12 col-md-4 mb-2">
            <div class="totals-card">
              <div class="totals-label">Total Business Gross Sales:</div>
              <div class="totals-value text-dark">${{ "{:,.2f}".format(total_gross_sales|default(0, true)) }}</div>
            </div>
          </div>
          <div class="col-12 col-md-6 mb-2">
            <div class="totals-card">
              <div class="totals-label">Total Advertising Fees Paid:</div>
              <div class="totals-value text-info">${{ "{:,.2f}".format(total_ad_fees|default(0, true)) }}</div>
            </div>
          </div>
          <div class="col-12 col-md-6 mb-2">
            <div class="totals-card">
              <div class="totals-label">Percent of Advertising Fees Paid by Perkminer:</div>
              <div class="totals-value text-warning">
                {{ percent_fees_paid|default(0, true)|round(1) }}%
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- --- END TOTALS SECTION --- -->
    </div>
  </section>
  <!-- Main content... -->
  <main class="container my-5">
    <!-- (categories and business listings as before...) -->
    <!-- Categories grid (same as before) -->
    <!-- ...snip for brevity, paste prior main/categories/listings code as before... -->
    <!-- Just make sure to keep the rest of your homepage after this as you already had! -->
  </main>
  <footer>
    <div>
      <div class="mb-2">
        <a href="/" style="color:var(--pm-primary);font-weight:600;text-decoration:none;">
          <img src="/static/logo.png" alt="Your Business Logo" style="height:34px;vertical-align:middle;">
        </a> &copy; 2026
      </div>
      <div>
        <small>Need help? <a href="mailto:support@perkminer.com" style="color:var(--pm-primary);">Contact Support</a></small>
      </div>
      <div class="mt-1">
        <a href="#" style="color:#3dbbee; margin:0 6px;text-decoration:none;">Privacy</a>
        <a href="#" style="color:#3dbbee; margin:0 6px;text-decoration:none;">Terms</a>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
          function(position) {
            document.getElementById('search-lat').value = position.coords.latitude;
            document.getElementById('search-lng').value = position.coords.longitude;
          }
        );
      }
    });
  </script>
</body>
</html>